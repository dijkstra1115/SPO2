# RGB-SpO2 多通道批量处理程式

## 概述

这个程式已经修改为支持**多通道批量处理**，无需每次手动修改参数。程式会自动检测数据中存在的通道，并为每个通道生成独立的结果文件。

## 主要改进

### 1. 多通道支持
- 一次运行可以处理多个通道
- 自动检测数据中可用的通道
- 跳过不存在的通道，避免错误

### 2. 独立输出文件
- 每个通道都有独立的输出文件
- 文件名包含通道名称，便于区分
- 支持并行处理多个通道

### 3. 智能通道检测
- 自动扫描所有CCT文件夹
- 检测哪些通道在数据中存在
- 只处理实际可用的通道

## 使用方法

### 1. 配置通道列表
在程式开头的 `CHANNEL_COLS` 参数中设置你要处理的通道：

```python
CHANNEL_COLS = [
    "pos",    # 位置通道
    "r",      # 红色通道
    "g",      # 绿色通道  
    "b",      # 蓝色通道
    "h",      # 色相通道
    "s",      # 饱和度通道
    "v",      # 明度通道
    "y",      # Y通道
    "cb",     # Cb通道
    "cr"      # Cr通道
]
```

### 2. 运行程式
```bash
python ab_construction_correlation.py
```

### 3. 查看输出
程式会为每个通道生成以下文件：

#### 在 `./model_para/CCT_xxxx/` 目录下：
- `ch_{channel_name}.csv` - 每个CCT下每位受试者的a,b参数

#### 在 `./model_line/` 目录下：
- `model_line_{channel_name}.csv` - 每个通道的模型参数
- `corr_model_line_{channel_name}.csv` - 每个通道的校正后参数
- `viz_ab_lines_corrected_{channel_name}.png` - 每个通道的AB关系图
- `viz_a_ranges_corrected_{channel_name}.png` - 每个通道的A值范围图

## 通道配置示例

### 只处理RGB通道
```python
CHANNEL_COLS = ["r", "g", "b"]
```

### 只处理HSV通道
```python
CHANNEL_COLS = ["h", "s", "v"]
```

### 只处理YCbCr通道
```python
CHANNEL_COLS = ["y", "cb", "cr"]
```

### 处理所有通道
```python
CHANNEL_COLS = ["pos", "r", "g", "b", "h", "s", "v", "y", "cb", "cr"]
```

## 程式流程

1. **自动检测**：扫描所有CCT文件夹，检测可用的通道
2. **批量处理**：对每个可用通道执行完整的处理流程
3. **独立输出**：为每个通道生成独立的结果文件
4. **错误处理**：如果某个通道处理失败，继续处理其他通道

## 注意事项

- 程式会自动跳过数据中不存在的通道
- 每个通道的处理是独立的，互不影响
- 如果某个通道处理失败，其他通道仍会正常处理
- 输出文件名包含通道名称，便于区分和管理

## 优势

- **效率提升**：一次运行处理多个通道，节省时间
- **自动化**：无需手动修改参数，减少人为错误
- **灵活性**：可以轻松添加或删除要处理的通道
- **可维护性**：代码结构更清晰，便于维护和扩展
